<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK-PRET Basel III Configuration Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .log { font-family: 'Courier New', monospace; padding: 8px; margin: 4px 0; border-radius: 4px; }
        .log-success { background: #f0fdf4; border-left: 4px solid #10b981; }
        .log-error { background: #fef2f2; border-left: 4px solid #ef4444; }
        .log-warning { background: #fffbeb; border-left: 4px solid #f59e0b; }
        .log-info { background: #eff6ff; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-6xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold text-gray-900 mb-6">üîß ZK-PRET Basel III Configuration Test</h1>
        
        <div class="grid md:grid-cols-2 gap-6">
            <!-- Test Controls -->
            <div class="space-y-4">
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h2 class="text-lg font-semibold text-blue-900 mb-4">Test Configuration</h2>
                    
                    <div class="space-y-3">
                        <button id="test-paths" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            üîç Test File Paths
                        </button>
                        
                        <button id="test-api" class="w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            üåê Test API Endpoint
                        </button>
                        
                        <button id="test-component" class="w-full bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                            ‚öôÔ∏è Test RiskComponent
                        </button>
                        
                        <button id="run-all" class="w-full bg-gray-800 text-white px-4 py-2 rounded hover:bg-gray-900">
                            üöÄ Run All Tests
                        </button>
                        
                        <button id="clear-log" class="w-full bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">
                            üóëÔ∏è Clear Log
                        </button>
                    </div>
                </div>
                
                <!-- Configuration Info -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h3 class="text-sm font-semibold text-yellow-900 mb-2">Expected Paths</h3>
                    <div class="text-xs text-yellow-800 space-y-1 font-mono">
                        <div><strong>ZK-PRET Base:</strong><br>C:\SATHYA\CHAINAIM3003\mcp-servers\zk-pret-test-v3.5</div>
                        <div><strong>Script:</strong><br>./build/tests/with-sign/RiskLiquidityBasel3OptimMerkleVerificationTestWithSign.js</div>
                        <div><strong>Config:</strong><br>./src/data/RISK/Basel3/CONFIG/basel3-VALID-2.json</div>
                        <div><strong>ACTUS URL:</strong><br>http://98.84.165.146:8083/eventsBatch</div>
                    </div>
                </div>
            </div>
            
            <!-- Test Results -->
            <div class="space-y-4">
                <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">Test Results</h2>
                    <div id="test-log" class="max-h-96 overflow-y-auto bg-white border border-gray-300 rounded p-3">
                        <div class="log log-info">
                            <strong>Basel III Configuration Test Ready</strong><br>
                            Click "Run All Tests" to verify complete configuration...
                        </div>
                    </div>
                </div>
                
                <!-- Summary -->
                <div id="summary" class="hidden bg-green-50 border border-green-200 rounded-lg p-4">
                    <h3 class="text-green-900 font-semibold mb-2">‚úÖ Test Summary</h3>
                    <div id="summary-content" class="text-green-800 text-sm"></div>
                </div>
            </div>
        </div>
        
        <!-- Command Test Section -->
        <div class="mt-6 bg-gray-50 border border-gray-200 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">üéØ Basel III Command Test</h3>
            <div class="bg-black text-green-400 p-4 rounded font-mono text-sm">
                <div class="text-yellow-400 mb-2"># Expected Command Pattern:</div>
                <div class="text-white">node ./build/tests/with-sign/RiskLiquidityBasel3OptimMerkleVerificationTestWithSign.js 100 100 http://98.84.165.146:8083/eventsBatch src/data/RISK/Basel3/CONFIG/basel3-VALID-2.json</div>
                <br>
                <div class="text-yellow-400 mb-2"># Working Directory:</div>
                <div class="text-white">C:\SATHYA\CHAINAIM3003\mcp-servers\zk-pret-test-v3.5</div>
                <br>
                <div class="text-yellow-400">Run the test-basel3-command.bat file I created to verify this command works!</div>
            </div>
        </div>
    </div>

    <script>
        const testLog = document.getElementById('test-log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log log-${type}`;
            entry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            testLog.appendChild(entry);
            testLog.scrollTop = testLog.scrollHeight;
        }
        
        function clearLog() {
            testLog.innerHTML = '<div class="log log-info"><strong>Log Cleared</strong><br>Ready for new tests...</div>';
            document.getElementById('summary').classList.add('hidden');
        }
        
        async function testFilePaths() {
            log('üîç Testing file paths and configuration...', 'info');
            
            const expectedPaths = {
                'ZK_PRET_STDIO_PATH': 'C:\\SATHYA\\CHAINAIM3003\\mcp-servers\\zk-pret-test-v3.5',
                'Script Path': './build/tests/with-sign/RiskLiquidityBasel3OptimMerkleVerificationTestWithSign.js',
                'Config Path': './src/data/RISK/Basel3/CONFIG/basel3-VALID-2.json',
                'ACTUS URL': 'http://98.84.165.146:8083/eventsBatch'
            };
            
            log('üìã Configuration from .env file:', 'info');
            Object.entries(expectedPaths).forEach(([key, value]) => {
                log(`  ${key}: ${value}`, 'info');
            });
            
            // Test the API endpoint to verify files are accessible
            try {
                const response = await fetch('/api/v1/basel3-config-files');
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Basel III API accessible - ${data.count} files found`, 'success');
                    log(`üìÅ Available files: ${data.files.join(', ')}`, 'info');
                    
                    if (data.files.includes('basel3-VALID-2.json')) {
                        log('‚úÖ Target config file (basel3-VALID-2.json) exists', 'success');
                    } else {
                        log('‚ùå Target config file (basel3-VALID-2.json) NOT found', 'error');
                    }
                } else {
                    log('‚ùå Basel III API not accessible', 'error');
                }
            } catch (error) {
                log(`‚ùå API test failed: ${error.message}`, 'error');
            }
            
            return true;
        }
        
        async function testAPI() {
            log('üåê Testing Basel III API endpoint...', 'info');
            
            try {
                const response = await fetch('/api/v1/basel3-config-files');
                log(`üì° Response status: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ API Success: Found ${data.count} configuration files`, 'success');
                    log(`üìÇ Files: ${data.files.join(', ')}`, 'info');
                    log(`üìç Path: ${data.path}`, 'info');
                    log(`üìã Data Type: ${data.dataType}`, 'info');
                    
                    // Verify expected files
                    const expectedFiles = ['basel3-VALID-1.json', 'basel3-VALID-2.json'];
                    expectedFiles.forEach(file => {
                        if (data.files.includes(file)) {
                            log(`‚úÖ Required file found: ${file}`, 'success');
                        } else {
                            log(`‚ùå Required file missing: ${file}`, 'error');
                        }
                    });
                    
                    return { success: true, data };
                } else {
                    const errorText = await response.text();
                    log(`‚ùå API Error: ${errorText}`, 'error');
                    return { success: false, error: errorText };
                }
            } catch (error) {
                log(`‚ùå Network Error: ${error.message}`, 'error');
                return { success: false, error: error.message };
            }
        }
        
        async function testRiskComponent() {
            log('‚öôÔ∏è Testing RiskComponent initialization...', 'info');
            
            try {
                // Check if RiskComponent is available
                if (typeof window.RiskComponent === 'undefined') {
                    log('‚ö†Ô∏è RiskComponent not loaded, attempting to load...', 'warning');
                    
                    // Try to load the script
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = '/js/components/risk.js';
                        script.onload = resolve;
                        script.onerror = () => reject(new Error('Failed to load risk.js'));
                        document.head.appendChild(script);
                    });
                    
                    if (typeof window.RiskComponent === 'undefined') {
                        log('‚ùå RiskComponent still not available after loading script', 'error');
                        return { success: false, error: 'RiskComponent not available' };
                    }
                    
                    log('‚úÖ RiskComponent script loaded successfully', 'success');
                } else {
                    log('‚úÖ RiskComponent already available', 'success');
                }
                
                // Create test DOM element for RiskComponent
                let testDiv = document.getElementById('test-risk-content');
                if (!testDiv) {
                    testDiv = document.createElement('div');
                    testDiv.id = 'risk-content';
                    testDiv.style.display = 'none';
                    document.body.appendChild(testDiv);
                    log('üì¶ Created test risk-content element', 'info');
                }
                
                // Try to instantiate RiskComponent
                log('üîß Creating RiskComponent instance...', 'info');
                const riskComponent = new window.RiskComponent();
                log('‚úÖ RiskComponent instance created successfully', 'success');
                
                // Test key methods
                if (typeof riskComponent.loadBasel3ConfigFiles === 'function') {
                    log('‚úÖ loadBasel3ConfigFiles method exists', 'success');
                } else {
                    log('‚ùå loadBasel3ConfigFiles method missing', 'error');
                }
                
                if (typeof riskComponent.render === 'function') {
                    log('‚úÖ render method exists', 'success');
                } else {
                    log('‚ùå render method missing', 'error');
                }
                
                // Clean up test element
                if (testDiv.style.display === 'none') {
                    document.body.removeChild(testDiv);
                    log('üßπ Cleaned up test element', 'info');
                }
                
                return { success: true, component: riskComponent };
                
            } catch (error) {
                log(`‚ùå RiskComponent test failed: ${error.message}`, 'error');
                log(`üîç Error details: ${error.stack}`, 'error');
                return { success: false, error: error.message };
            }
        }
        
        async function runAllTests() {
            log('üöÄ Starting comprehensive Basel III configuration test...', 'info');
            
            const results = {
                paths: false,
                api: false,
                component: false
            };
            
            // Test 1: File Paths
            log('=== TEST 1: FILE PATHS ===', 'info');
            results.paths = await testFilePaths();
            
            // Test 2: API Endpoint
            log('=== TEST 2: API ENDPOINT ===', 'info');
            const apiResult = await testAPI();
            results.api = apiResult.success;
            
            // Test 3: RiskComponent
            log('=== TEST 3: RISK COMPONENT ===', 'info');
            const componentResult = await testRiskComponent();
            results.component = componentResult.success;
            
            // Summary
            log('=== SUMMARY ===', 'info');
            log(`File Paths: ${results.paths ? '‚úÖ PASS' : '‚ùå FAIL'}`, results.paths ? 'success' : 'error');
            log(`API Endpoint: ${results.api ? '‚úÖ PASS' : '‚ùå FAIL'}`, results.api ? 'success' : 'error');
            log(`RiskComponent: ${results.component ? '‚úÖ PASS' : '‚ùå FAIL'}`, results.component ? 'success' : 'error');
            
            const allPassed = results.paths && results.api && results.component;
            log(`Overall Result: ${allPassed ? '‚úÖ ALL TESTS PASSED' : '‚ùå SOME TESTS FAILED'}`, allPassed ? 'success' : 'error');
            
            // Show summary
            const summary = document.getElementById('summary');
            const summaryContent = document.getElementById('summary-content');
            
            if (allPassed) {
                summary.className = 'bg-green-50 border border-green-200 rounded-lg p-4';
                summaryContent.innerHTML = `
                    <div class="text-green-800">
                        <div class="font-semibold mb-2">‚úÖ Configuration is correct!</div>
                        <div class="space-y-1 text-sm">
                            <div>‚Ä¢ Basel III script exists in ZK-PRET</div>
                            <div>‚Ä¢ Configuration files are accessible</div>
                            <div>‚Ä¢ API endpoint is working</div>
                            <div>‚Ä¢ RiskComponent can be initialized</div>
                        </div>
                        <div class="mt-3 p-2 bg-green-100 rounded">
                            <strong>Next Step:</strong> Basel III tab should work. If it's still empty, 
                            try clearing browser cache and restarting the server.
                        </div>
                    </div>
                `;
            } else {
                summary.className = 'bg-red-50 border border-red-200 rounded-lg p-4';
                summaryContent.innerHTML = `
                    <div class="text-red-800">
                        <div class="font-semibold mb-2">‚ùå Configuration issues found!</div>
                        <div class="space-y-1 text-sm">
                            ${!results.paths ? '<div>‚Ä¢ File path configuration needs checking</div>' : ''}
                            ${!results.api ? '<div>‚Ä¢ API endpoint is not working</div>' : ''}
                            ${!results.component ? '<div>‚Ä¢ RiskComponent has initialization issues</div>' : ''}
                        </div>
                        <div class="mt-3 p-2 bg-red-100 rounded">
                            <strong>Action Required:</strong> Check the error messages above and fix the failing components.
                        </div>
                    </div>
                `;
            }
            
            summary.classList.remove('hidden');
            
            if (allPassed) {
                log('üéâ Configuration test completed successfully!', 'success');
                log('üí° Try running the Basel III command manually:', 'info');
                log('   1. Open command prompt', 'info');
                log('   2. cd "C:\\SATHYA\\CHAINAIM3003\\mcp-servers\\zk-pret-test-v3.5"', 'info');
                log('   3. Run: node ./build/tests/with-sign/RiskLiquidityBasel3OptimMerkleVerificationTestWithSign.js 100 100 http://98.84.165.146:8083/eventsBatch src/data/RISK/Basel3/CONFIG/basel3-VALID-2.json', 'info');
            }
        }
        
        // Event listeners
        document.getElementById('test-paths').addEventListener('click', testFilePaths);
        document.getElementById('test-api').addEventListener('click', testAPI);
        document.getElementById('test-component').addEventListener('click', testRiskComponent);
        document.getElementById('run-all').addEventListener('click', runAllTests);
        document.getElementById('clear-log').addEventListener('click', clearLog);
    </script>
</body>
</html>